<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema Vidraceiro Pro - V1.1</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
  <style>
    /* ------------------------------------------- */
    /* Reset + Base */
    /* ------------------------------------------- */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 24px;
    }
    .container { max-width: 1200px; margin: 0 auto; }

    /* ------------------------------------------- */
    /* Header */
    /* ------------------------------------------- */
    .header {
      background: white;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 8px 15px rgba(0,0,0,0.15);
      margin-bottom: 30px;
      text-align: center;
    }
    .header h1 {
      margin: 0 0 8px 0;
      font-size: 36px;
      color: #1a202c;
      font-weight: 800;
    }
    .header p {
      margin: 0;
      font-size: 18px;
      color: #718096;
    }

    /* ------------------------------------------- */
    /* Tabs */
    /* ------------------------------------------- */
    .tabs { display: flex; gap: 16px; margin-bottom: 24px; flex-wrap: wrap; }
    .tab-button {
      flex: 1; min-width: 150px; padding: 16px 24px; background: white; border: none; border-radius: 12px;
      font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    .tab-button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    .tab-button.active { background: #667eea; color: white; box-shadow: 0 6px 12px rgba(102,126,234,0.4); }

    .content-card {
      background: white; padding: 32px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .section-title {
      font-size: 28px; font-weight: 700; color: #1a202c; margin: 0 0 24px 0;
      padding-bottom: 12px; border-bottom: 4px solid #667eea;
    }

    .ferragens-info{
      background:#e0f2fe;border:2px solid #38bdf8;border-radius:12px;padding:18px;margin:24px 0;
      text-align:center;display:flex;align-items:center;justify-content:center;gap:10px;
      box-shadow:0 2px 4px rgba(0,0,0,0.05)
    }

    .calculator-section{background:#f7fafc;padding:30px;border-radius:12px;margin-top:24px;border:1px solid #e2e8f0}
    .input-group{margin-bottom:20px}
    .input-group label{display:block;font-weight:600;margin-bottom:8px;color:#2d3748;font-size:16px}
    .input-row{display:flex;gap:16px;flex-wrap:wrap}
    .input-field{flex:1;min-width:250px}
    .input-field input,.glass-options select{
      width:100%;padding:14px 16px;border:2px solid #e2e8f0;border-radius:10px;font-size:17px;transition:all .3s
    }
    .input-field input:focus,.glass-options select:focus{
      outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.2)
    }
    .glass-options{margin-top:30px;padding-top:15px;border-top:1px dashed #cbd5e0}
    .checkbox-group{display:flex;align-items:center;gap:12px;margin-top:24px;font-size:16px;font-weight:600;color:#2d3748}
    .checkbox-group input[type="checkbox"]{width:24px;height:24px;cursor:pointer;border:2px solid #667eea;border-radius:4px}
    .calculate-button{
      width:100%;padding:18px;background:#667eea;color:#fff;border:none;border-radius:10px;font-size:20px;font-weight:700;
      cursor:pointer;transition:background .3s, transform .2s;margin-top:30px;display:flex;align-items:center;justify-content:center;gap:10px
    }
    .calculate-button:hover{background:#5568d3;transform:translateY(-1px)}

    /* ------------------------------------------- */
    /* Results */
    /* ------------------------------------------- */
    .results{
      margin-top:30px;padding:24px;background:#f0f4ff;border-radius:12px;border:3px solid #667eea;
      opacity:0;transform:translateY(20px);transition:all .5s ease-out
    }
    .results.visible{opacity:1;transform:translateY(0)}
    .results h3{margin:0 0 16px 0;color:#3f51b5;font-size:22px;font-weight:700}
    .result-item{padding:15px;background:#fff;border-radius:10px;margin-bottom:15px;border-left:5px solid #667eea;box-shadow:0 1px 3px rgba(0,0,0,0.05)}
    .result-item.highlighted{background:#e9d5ff;border-left:8px solid #9333ea;padding:20px 15px}
    .result-item.highlighted .result-label{color:#6d28d9;font-size:16px}
    .result-item.highlighted .result-value{color:#9333ea;font-size:24px;font-weight:900}
    .result-label{font-weight:600;color:#4a5568;margin-bottom:4px;font-size:14px}
    .result-value{font-size:18px;color:#667eea;font-weight:700}
    .results-layout{display:grid;grid-template-columns:1fr 1fr;gap:30px}

    .box-visual{
      background:#fff;border:2px solid #e2e8f0;border-radius:12px;padding:30px 15px;min-height:420px;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);position:relative;display:flex;flex-direction:column;gap:16px
    }
    .original-vao-label{
      margin-top:15px;padding:8px 15px;background:#fffbe0;border-radius:8px;font-size:14px;font-weight:600;color:#92400e;
      border:1px solid #f59e0b;text-align:center;width:100%
    }
    .action-indicator{position:absolute;top:15px;right:15px;font-size:28px;color:#667eea;font-weight:bold;opacity:.8;z-index:10;line-height:1}

    /* ------------------------------------------- */
    /* ESTILOS NOVOS PARA A VISUALIZA√á√ÉO           */
    /* (Antes inexistentes, por isso nada aparecia)*/
    /* ------------------------------------------- */
    .visualization-header{display:flex;flex-direction:column;gap:4px;text-align:center}
    .project-title{font-weight:800;color:#1f2937}
    .project-subtitle{font-size:12px;color:#6b7280}

    /* √Årea que cont√©m o desenho (centraliza e d√° altura) */
    .glass-diagram,.box-diagram{
      flex:1;display:flex;align-items:flex-end;justify-content:center;
      border:1px dashed #e5e7eb;border-radius:10px;background:linear-gradient(180deg, #f9fafb 0%, #f3f4f6 100%);
      padding:12px; position:relative; overflow:hidden;
    }

    /* Pe√ßa √∫nica (porta/janela) */
    .single-glass{
      position:relative;border:3px solid rgba(0,0,0,0.08);border-radius:8px;display:flex;align-items:center;justify-content:center;
      flex-direction:column;font-weight:700;backdrop-filter:saturate(120%) blur(0.3px);
      transition:transform .2s ease; user-select:none;
    }
    .single-glass:hover{transform:translateY(-2px)}

    /* Partes do box */
    .box-part{
      position:relative;border:3px solid rgba(0,0,0,0.08);border-radius:8px;margin:0 3px;
      display:flex;align-items:center;justify-content:center;flex-direction:column;font-weight:700;user-select:none;
      transition:transform .2s ease;
    }
    .box-part:hover{transform:translateY(-2px)}

    /* Cores de vidro */
    .glass-incolor{ background: linear-gradient(180deg, rgba(255,255,255,0.75), rgba(230,245,255,0.8)); }
    .glass-verde  { background: linear-gradient(180deg, rgba(210,255,230,0.75), rgba(180,240,210,0.8)); }
    .glass-fume   { background: linear-gradient(180deg, rgba(210,210,210,0.7), rgba(170,170,170,0.8)); }

    /* R√≥tulos de dimens√£o (em px na tela, mas exibem mm) */
    .dimension-width, .dimension-height{
      position:absolute; font-size:11px; font-weight:800; color:#374151; background:#ffffffb3; padding:3px 6px;
      border:1px solid #e5e7eb; border-radius:999px; backdrop-filter: blur(2px);
    }
    .dimension-width{ bottom:-10px; left:50%; transform:translateX(-50%); }
    .dimension-height{ right:-10px; top:50%; transform:translateY(-50%) rotate(-90deg); }

    /* Grade de medidas e specs */
    .measurements-grid{
      margin-top:8px; display:grid; grid-template-columns:repeat(3,1fr); gap:10px;
    }
    .measurement-item{background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:10px;text-align:center}
    .measurement-label{font-size:12px;color:#6b7280}
    .measurement-value{font-size:14px;font-weight:800;color:#111827}

    .glass-specs{margin-top:8px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center}
    .spec-item{display:flex;align-items:center;gap:8px;background:#fff;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px}
    .spec-icon{
      display:grid;place-items:center;width:22px;height:22px;border-radius:999px;background:#667eea;color:#fff;font-weight:900;font-size:12px
    }
    .spec-color{background:#0ea5e9} .spec-thickness{background:#10b981} .spec-type{background:#f59e0b}

    .print-info{margin-top:6px;text-align:center;color:#6b7280;font-size:12px}

    /* ------------------------------------------- */
    /* Responsivo e Print */
    /* ------------------------------------------- */
    @media (max-width: 900px){ .results-layout{ grid-template-columns:1fr } .input-field{ min-width:100% } }
    @media (max-width: 768px){ .header h1{font-size:30px} .section-title{font-size:24px} .box-visual{ min-height:350px } }
    @media print {
      body{ background:#fff !important; padding:10px }
      .header,.tabs,.calculator-section,.calculate-button{ display:none }
      .content-card{ box-shadow:none; padding:0 }
      .results{ opacity:1 !important; transform:none !important; border:1px solid #000; background:#fff; margin:20px 0 }
      .box-visual{ border-color:#000 !important; box-shadow:none !important }
      .box-part,.single-glass{ border-color:#000 !important; color:#000 !important; background:#f0f0f0 !important }
      .glass-incolor{ background:#fff !important } .glass-verde{ background:#e0e0e0 !important } .glass-fume{ background:#c0c0c0 !important }
      .ferragens-info{ background:#f5f5f5; border-color:#999; color:#000 } .ferragens-info strong{ color:#000 }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1 id="app-title">Sistema Vidraceiro Pro</h1>
      <p id="company-name">C√°lculos R√°pidos e Medidas de Produ√ß√£o</p>
    </header>

    <div class="tabs">
      <button class="tab-button active" data-tab="porta-pivotante">üö™ Porta Pivotante</button>
      <button class="tab-button" data-tab="janela-basculante">ü™ü Janela Basculante</button>
      <button class="tab-button" data-tab="box">üöø Box Padr√£o</button>
    </div>

    <div class="content-card">
      <!-- PORTA -->
      <section id="porta-pivotante" class="tab-content">
        <h2 class="section-title">Porta Pivotante - C√°lculo de Produ√ß√£o</h2>
        <div class="ferragens-info"><span>üõ†Ô∏è</span> <strong>Ferragens Inclu√≠das: Kit01 + Puxador</strong></div>

        <div class="calculator-section">
          <h3 style="margin-top:0;color:#2d3748;">Calculadora de Medidas</h3>

          <h4 style="color:#2d3748;margin:20px 0 12px 0;font-weight:700;">1. Medidas Totais do V√£o (mm)</h4>
          <div class="input-row">
            <div class="input-field">
              <label for="porta-altura">Altura Total do V√£o (mm)</label>
              <input type="number" id="porta-altura" placeholder="Ex: 2100" required>
            </div>
            <div class="input-field">
              <label for="porta-largura">Largura Total do V√£o (mm)</label>
              <input type="number" id="porta-largura" placeholder="Ex: 900" required>
            </div>
          </div>

          <div class="glass-options">
            <h4 style="color:#2d3748;margin:20px 0 12px 0;font-weight:700;">2. Especifica√ß√µes do Vidro</h4>
            <div class="input-row">
              <div class="input-field">
                <label for="porta-glass-color">Cor do Vidro</label>
                <select id="porta-glass-color">
                  <option value="incolor">Incolor</option>
                  <option value="verde">Verde</option>
                  <option value="fume">Fum√™</option>
                </select>
              </div>
              <div class="input-field">
                <label for="porta-glass-thickness">Espessura (mm)</label>
                <select id="porta-glass-thickness">
                  <option value="6">6mm</option>
                  <option value="8" selected>8mm (Padr√£o)</option>
                  <option value="10">10mm</option>
                </select>
              </div>
              <div class="input-field">
                <label for="porta-glass-type">Tipo do Vidro</label>
                <select id="porta-glass-type">
                  <option value="temperado" selected>Temperado (Obrigat√≥rio)</option>
                </select>
              </div>
            </div>
          </div>

          <button class="calculate-button" id="porta-calculate-btn">‚úÖ Calcular e Visualizar Pe√ßa</button>

          <div id="porta-results" class="results hidden">
            <div class="results-layout">
              <div class="visual-section">
                <h3>Representa√ß√£o Visual (Pe√ßa de Produ√ß√£o)</h3>
                <div id="porta-visual" class="box-visual"></div>
                <div class="original-vao-label" id="porta-original-vao-label" style="display:none;"></div>
              </div>
              <div class="specs-section">
                <h3>Resumo T√©cnico</h3>
                <div class="result-item highlighted">
                  <div class="result-label">üìê Medidas de PRODU√á√ÉO (Corte)</div>
                  <div class="result-value" id="porta-result-medidas">-</div>
                </div>
                <div class="result-item"><div class="result-label">Tipo de Produto</div><div class="result-value">Porta Pivotante</div></div>
                <div class="result-item"><div class="result-label">Vidro</div><div class="result-value" id="porta-result-glass">-</div></div>
                <div class="result-item"><div class="result-label">Ferragens</div><div class="result-value">Kit01 + Puxador</div></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- JANELA -->
      <section id="janela-basculante" class="tab-content hidden">
        <h2 class="section-title">Janela Basculante - C√°lculo de Produ√ß√£o</h2>
        <div class="ferragens-info"><span>üõ†Ô∏è</span> <strong>Ferragens Inclu√≠das: Kit06 + Roldana</strong></div>

        <div class="calculator-section">
          <h3 style="margin-top:0;color:#2d3748;">Calculadora de Medidas</h3>

          <h4 style="color:#2d3748;margin:20px 0 12px 0;font-weight:700;">1. Medidas Totais do V√£o (mm)</h4>
          <div class="input-row">
            <div class="input-field">
              <label for="janela-altura">Altura Total do V√£o (mm)</label>
              <input type="number" id="janela-altura" placeholder="Ex: 1200" required>
            </div>
            <div class="input-field">
              <label for="janela-largura">Largura Total do V√£o (mm)</label>
              <input type="number" id="janela-largura" placeholder="Ex: 1000" required>
            </div>
          </div>

          <div class="glass-options">
            <h4 style="color:#2d3748;margin:20px 0 12px 0;font-weight:700;">2. Especifica√ß√µes do Vidro</h4>
            <div class="input-row">
              <div class="input-field">
                <label for="janela-glass-color">Cor do Vidro</label>
                <select id="janela-glass-color">
                  <option value="incolor">Incolor</option>
                  <option value="verde">Verde</option>
                  <option value="fume">Fum√™</option>
                </select>
              </div>
              <div class="input-field">
                <label for="janela-glass-thickness">Espessura (mm)</label>
                <select id="janela-glass-thickness">
                  <option value="6" selected>6mm (Padr√£o)</option>
                  <option value="8">8mm</option>
                </select>
              </div>
              <div class="input-field">
                <label for="janela-glass-type">Tipo do Vidro</label>
                <select id="janela-glass-type">
                  <option value="temperado" selected>Temperado</option>
                </select>
              </div>
            </div>
          </div>

          <button class="calculate-button" id="janela-calculate-btn">‚úÖ Calcular e Visualizar Pe√ßa</button>

          <div id="janela-results" class="results hidden">
            <div class="results-layout">
              <div class="visual-section">
                <h3>Representa√ß√£o Visual (Pe√ßa de Produ√ß√£o)</h3>
                <div id="janela-visual" class="box-visual"></div>
                <div class="original-vao-label" id="janela-original-vao-label" style="display:none;"></div>
              </div>
              <div class="specs-section">
                <h3>Resumo T√©cnico</h3>
                <div class="result-item highlighted">
                  <div class="result-label">üìê Medidas de PRODU√á√ÉO (Corte)</div>
                  <div class="result-value" id="janela-result-medidas">-</div>
                </div>
                <div class="result-item"><div class="result-label">Tipo de Produto</div><div class="result-value">Janela Basculante</div></div>
                <div class="result-item"><div class="result-label">Vidro</div><div class="result-value" id="janela-result-glass">-</div></div>
                <div class="result-item"><div class="result-label">Ferragens</div><div class="result-value">Kit06 + Roldana</div></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- BOX -->
      <section id="box" class="tab-content hidden">
        <h2 class="section-title">Box Padr√£o (Fixo + Porta) - C√°lculo de Produ√ß√£o</h2>

        <div class="calculator-section">
          <h3 style="margin-top:0;color:#2d3748;">Calculadora de Medidas</h3>

          <h4 style="color:#2d3748;margin:20px 0 12px 0;font-weight:700;">1. Medidas Totais do V√£o (mm)</h4>
          <div class="input-row">
            <div class="input-field">
              <label for="vao-altura">Altura Total do V√£o (mm)</label>
              <input type="number" id="vao-altura" placeholder="Ex: 2000" required>
            </div>
            <div class="input-field">
              <label for="vao-largura">Largura Total do V√£o (mm)</label>
              <input type="number" id="vao-largura" placeholder="Ex: 1200" required>
            </div>
          </div>

          <div class="glass-options">
            <h4 style="color:#2d3748;margin:20px 0 12px 0;font-weight:700;">2. Especifica√ß√µes do Vidro</h4>
            <div class="input-row">
              <div class="input-field">
                <label for="glass-color">Cor do Vidro</label>
                <select id="glass-color">
                  <option value="incolor">Incolor</option>
                  <option value="verde">Verde</option>
                  <option value="fume">Fum√™</option>
                </select>
              </div>
              <div class="input-field">
                <label for="glass-thickness">Espessura (mm)</label>
                <select id="glass-thickness">
                  <option value="8" selected>8mm (Padr√£o)</option>
                  <option value="10">10mm</option>
                </select>
              </div>
              <div class="input-field">
                <label for="glass-type">Tipo do Vidro</label>
                <select id="glass-type">
                  <option value="temperado" selected>Temperado (Obrigat√≥rio)</option>
                </select>
              </div>
            </div>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="com-kit">
            <label for="com-kit">Incluir Kit de Alum√≠nio (Guia + Perfis)</label>
          </div>

          <button class="calculate-button" id="calculate-btn">‚úÖ Calcular e Visualizar Pe√ßas</button>

          <div id="results" class="results hidden">
            <div class="results-layout">
              <div class="visual-section">
                <h3>Representa√ß√£o Visual (Pe√ßas de Produ√ß√£o)</h3>
                <div id="box-visual" class="box-visual"></div>
                <div class="original-vao-label" id="box-original-vao-label" style="display:none;"></div>
              </div>
              <div class="specs-section">
                <h3>Resumo T√©cnico</h3>
                <div class="result-item highlighted">
                  <div class="result-label">üìê PORTA M√ìVEL - Medida de PRODU√á√ÉO</div>
                  <div class="result-value" id="result-movel">-</div>
                </div>
                <div class="result-item highlighted">
                  <div class="result-label">üìê FIXO - Medida de PRODU√á√ÉO</div>
                  <div class="result-value" id="result-fixo">-</div>
                </div>
                <div class="result-item"><div class="result-label">Tamanho Nominal do Box</div><div class="result-value" id="result-box-size">-</div></div>
                <div class="result-item"><div class="result-label">Vidro</div><div class="result-value" id="result-glass">-</div></div>
                <div class="result-item"><div class="result-label">Configura√ß√£o</div><div class="result-value" id="result-config">-</div></div>
              </div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </div>

  <script>
    const defaultConfig = {
      app_title: "Sistema Vidraceiro Pro",
      company_name: "C√°lculos R√°pidos e Medidas de Produ√ß√£o"
    };

    function clamp(n){ return Math.max(1, Math.round(n)); }

    function showResults(elementId) {
      const el = document.getElementById(elementId);
      el.classList.remove('hidden');
      void el.offsetWidth; // for√ßa reflow para animar
      el.classList.add('visible');
      // scroll suave at√© os resultados
      el.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    /* ------------------------------------------- */
    /* AJUSTES DE C√ÅLCULO/RENDER (corrigido)       */
    /* ------------------------------------------- */
    function createSingleGlassVisualization(altura, largura, glassColor, type, glassThickness, glassType, ferragens, originalAltura, originalLargura) {
      // Prote√ß√£o contra negativos e fra√ß√µes
      altura = clamp(altura);
      largura = clamp(largura);

      const maxSide = Math.max(largura, altura);
      const scale = 260 / (maxSide || 1);
      const visualWidth  = Math.max(30, Math.round(largura * scale));
      const visualHeight = Math.max(30, Math.round(altura * scale));

      const glassColorText = { incolor:'Incolor', verde:'Verde', fume:'Fum√™' };
      const typeText = type === 'PORTA' ? 'Porta Pivotante' : 'Janela Basculante';
      const indicator = type === 'PORTA' ? '‚ü≤' : '‚Æô';

      const labelId = `${type.toLowerCase()}-original-vao-label`;
      const labelEl = document.getElementById(labelId);
      if (labelEl){
        labelEl.textContent = `V√£o Original: ${clamp(originalLargura)}mm (L) x ${clamp(originalAltura)}mm (A)`;
        labelEl.style.display = 'block';
      }

      return `
        <div class="visualization-header">
          <div class="project-title">${typeText}</div>
          <div class="project-subtitle">Pe√ßa Pronta ‚Äî Medidas de Produ√ß√£o</div>
        </div>

        <div class="glass-diagram">
          <div class="single-glass glass-${glassColor}" style="width:${visualWidth}px;height:${visualHeight}px;">
            <span class="action-indicator" title="${typeText}">${indicator}</span>
            <div>${type.toUpperCase()}</div>
            <div style="font-size:14px;margin-top:8px;opacity:.8;">${largura} √ó ${altura}mm</div>
            <div class="dimension-width">${largura}mm</div>
            <div class="dimension-height">${altura}mm</div>
          </div>
        </div>

        <div class="measurements-grid">
          <div class="measurement-item"><div class="measurement-label">Largura</div><div class="measurement-value">${largura}mm</div></div>
          <div class="measurement-item"><div class="measurement-label">Altura</div><div class="measurement-value">${altura}mm</div></div>
          <div class="measurement-item"><div class="measurement-label">√Årea Total</div><div class="measurement-value">${((largura*altura)/1_000_000).toFixed(2)} m¬≤</div></div>
        </div>

        <div class="glass-specs">
          <div class="spec-item"><div class="spec-icon spec-color">C</div><span>${glassColorText[glassColor]}</span></div>
          <div class="spec-item"><div class="spec-icon spec-thickness">E</div><span>${glassThickness}mm</span></div>
          <div class="spec-item"><div class="spec-icon spec-type">T</div><span>${glassType[0].toUpperCase()+glassType.slice(1)}</span></div>
          <div class="spec-item"><div class="spec-icon" style="background:#6366f1;">F</div><span>${ferragens}</span></div>
        </div>

        <div class="print-info">Gerado em ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}</div>
      `;
    }

    function createBoxVisualization(alturaMovel, larguraMovel, alturaFixo, larguraFixo, glassColor, glassThickness, glassType, comKit, originalAltura, originalLargura) {
      // Prote√ß√µes e arredondamento
      alturaMovel  = clamp(alturaMovel);
      larguraMovel = clamp(larguraMovel);
      alturaFixo   = clamp(alturaFixo);
      larguraFixo  = clamp(larguraFixo);

      const totalWidth = larguraMovel + larguraFixo;
      const maxHeight  = Math.max(alturaMovel, alturaFixo);
      const scale = 260 / Math.max(totalWidth, maxHeight);
      const vwMovel = Math.max(26, Math.round(larguraMovel * scale));
      const vwFixo  = Math.max(26, Math.round(larguraFixo  * scale));
      const vHeight = Math.max(40, Math.round(maxHeight * scale));

      const glassColorText = { incolor:'Incolor', verde:'Verde', fume:'Fum√™' };

      const labelEl = document.getElementById('box-original-vao-label');
      if (labelEl){
        labelEl.textContent = `V√£o Original: ${clamp(originalLargura)}mm (L) x ${clamp(originalAltura)}mm (A)`;
        labelEl.style.display = 'block';
      }

      return `
        <div class="visualization-header">
          <div class="project-title">Box para Banheiro (Fixo + M√≥vel)</div>
          <div class="project-subtitle">Projeto T√©cnico ‚Äî Medidas de Produ√ß√£o</div>
        </div>

        <div class="box-diagram" style="height:${vHeight + 20}px;">
          <div class="box-part movel glass-${glassColor}" style="width:${vwMovel}px;height:${vHeight}px;">
            <div>PORTA M√ìVEL</div>
            <div style="font-size:12px;margin-top:6px;opacity:.8;">${larguraMovel} √ó ${alturaMovel}mm</div>
            <div class="dimension-width">${larguraMovel}mm</div>
          </div>

          <div class="box-part fixo glass-${glassColor}" style="width:${vwFixo}px;height:${vHeight}px;">
            <div>FIXO</div>
            <div style="font-size:12px;margin-top:6px;opacity:.8;">${larguraFixo} √ó ${alturaFixo}mm</div>
            <div class="dimension-width">${larguraFixo}mm</div>
          </div>

          <div class="dimension-height">${maxHeight}mm</div>
        </div>

        <div class="measurements-grid">
          <div class="measurement-item"><div class="measurement-label">Total V√£o</div><div class="measurement-value">${clamp(originalLargura)}mm</div></div>
          <div class="measurement-item"><div class="measurement-label">Altura M√°xima</div><div class="measurement-value">${clamp(originalAltura)}mm</div></div>
          <div class="measurement-item"><div class="measurement-label">√Årea Total Vidro</div><div class="measurement-value">${((larguraMovel*alturaMovel + larguraFixo*alturaFixo)/1_000_000).toFixed(2)} m¬≤</div></div>
        </div>

        <div class="glass-specs">
          <div class="spec-item"><div class="spec-icon spec-color">C</div><span>${glassColorText[glassColor]}</span></div>
          <div class="spec-item"><div class="spec-icon spec-thickness">E</div><span>${glassThickness}mm</span></div>
          <div class="spec-item"><div class="spec-icon spec-type">T</div><span>${glassType[0].toUpperCase()+glassType.slice(1)}</span></div>
          ${comKit ? '<div class="spec-item"><div class="spec-icon" style="background:#10b981;">KIT</div><span>Com Kit Alum√≠nio</span></div>' : ''}
        </div>

        <div class="print-info">Gerado em ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}</div>
      `;
    }

    function determineBoxSizeLabel(largura) {
      if (largura <= 1000) return 'Box Pequeno';
      if (largura <= 1400) return 'Box M√©dio';
      if (largura <= 2000) return 'Box Grande';
      return 'Box Especial';
    }

    function setupTabs() {
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          const tabName = button.dataset.tab;
          tabButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');

          tabContents.forEach(content => {
            content.classList.add('hidden');
            if (content.id === tabName) content.classList.remove('hidden');
          });
        });
      });
    }

    /* ------------------------------------------- */
    /* C√ÅLCULOS                                    */
    /* ------------------------------------------- */
    function calculateBox() {
      const altura  = parseFloat(document.getElementById('vao-altura').value);
      const largura = parseFloat(document.getElementById('vao-largura').value);
      const comKit  = document.getElementById('com-kit').checked;
      const glassColor = document.getElementById('glass-color').value;
      const glassThickness = document.getElementById('glass-thickness').value;
      const glassType = document.getElementById('glass-type').value;

      if (!altura || !largura || altura <= 0 || largura <= 0) {
        alert('Preencha Altura e Largura do v√£o com valores v√°lidos.');
        return;
      }

      // Heur√≠stica simples de produ√ß√£o (exemplo)
      const alturaBase = altura - 50;
      const larguraBase = largura / 2;

      const larguraMovel = clamp(larguraBase + 50);
      const larguraFixo  = clamp(larguraBase);
      const alturaProducaoMovel = clamp(alturaBase - 20);
      const alturaProducaoFixo  = clamp(alturaBase - 20);

      const viz = createBoxVisualization(
        alturaProducaoMovel, larguraMovel,
        alturaProducaoFixo,  larguraFixo,
        glassColor, glassThickness, glassType, comKit,
        altura, largura
      );
      document.getElementById('box-visual').innerHTML = viz;

      document.getElementById('result-box-size').textContent = determineBoxSizeLabel(largura);
      document.getElementById('result-movel').textContent = `${larguraMovel}mm (L) √ó ${alturaProducaoMovel}mm (A)`;
      document.getElementById('result-fixo').textContent  = `${larguraFixo}mm (L) √ó ${alturaProducaoFixo}mm (A)`;

      const glassColorText = { incolor:'Incolor', verde:'Verde', fume:'Fum√™' };
      document.getElementById('result-glass').textContent =
        `${glassColorText[glassColor]} ${glassThickness}mm ${glassType[0].toUpperCase()+glassType.slice(1)}`;
      document.getElementById('result-config').textContent =
        `Box Padr√£o ${comKit ? 'COM Kit de Alum√≠nio' : 'SEM Kit de Alum√≠nio'}`;

      showResults('results');
    }

    function calculatePorta() {
      const altura  = parseFloat(document.getElementById('porta-altura').value);
      const largura = parseFloat(document.getElementById('porta-largura').value);
      const glassColor = document.getElementById('porta-glass-color').value;
      const glassThickness = document.getElementById('porta-glass-thickness').value;
      const glassType = document.getElementById('porta-glass-type').value;

      if (!altura || !largura || altura <= 0 || largura <= 0) {
        alert('Preencha Altura e Largura do v√£o com valores v√°lidos.');
        return;
      }

      // Exemplo de desconto
      const alturaProducao  = clamp(altura - 15);
      const larguraProducao = clamp(largura - 7);

      const viz = createSingleGlassVisualization(
        alturaProducao, larguraProducao, glassColor, 'PORTA',
        glassThickness, glassType, 'Kit01 + Puxador',
        altura, largura
      );
      document.getElementById('porta-visual').innerHTML = viz;

      const glassColorText = { incolor:'Incolor', verde:'Verde', fume:'Fum√™' };
      document.getElementById('porta-result-medidas').textContent = `${larguraProducao}mm (L) √ó ${alturaProducao}mm (A)`;
      document.getElementById('porta-result-glass').textContent =
        `${glassColorText[glassColor]} ${glassThickness}mm ${glassType[0].toUpperCase()+glassType.slice(1)}`;

      showResults('porta-results');
    }

    function calculateJanela() {
      const altura  = parseFloat(document.getElementById('janela-altura').value);
      const largura = parseFloat(document.getElementById('janela-largura').value);
      const glassColor = document.getElementById('janela-glass-color').value;
      const glassThickness = document.getElementById('janela-glass-thickness').value;
      const glassType = document.getElementById('janela-glass-type').value;

      if (!altura || !largura || altura <= 0 || largura <= 0) {
        alert('Preencha Altura e Largura do v√£o com valores v√°lidos.');
        return;
      }

      // Exemplo de desconto
      const alturaProducao  = clamp(altura - 7);
      const larguraProducao = clamp(largura - 15);

      const viz = createSingleGlassVisualization(
        alturaProducao, larguraProducao, glassColor, 'JANELA',
        glassThickness, glassType, 'Kit06 + Roldana',
        altura, largura
      );
      document.getElementById('janela-visual').innerHTML = viz;

      const glassColorText = { incolor:'Incolor', verde:'Verde', fume:'Fum√™' };
      document.getElementById('janela-result-medidas').textContent = `${larguraProducao}mm (L) √ó ${alturaProducao}mm (A)`;
      document.getElementById('janela-result-glass').textContent =
        `${glassColorText[glassColor]} ${glassThickness}mm ${glassType[0].toUpperCase()+glassType.slice(1)}`;

      showResults('janela-results');
    }

    async function onConfigChange(config) {
      document.getElementById('app-title').textContent   = config.app_title   || defaultConfig.app_title;
      document.getElementById('company-name').textContent= config.company_name|| defaultConfig.company_name;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [{
            get: () => config.primary_color || "#667eea",
            set: (value) => { config.primary_color = value; window.elementSdk.setConfig({ primary_color: value }); }
          }],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title",   config.app_title   || defaultConfig.app_title],
          ["company_name",config.company_name|| defaultConfig.company_name]
        ])
      });
    }

    // Init
    setupTabs();
    document.getElementById('calculate-btn').addEventListener('click', e => { e.preventDefault(); calculateBox(); });
    document.getElementById('porta-calculate-btn').addEventListener('click', e => { e.preventDefault(); calculatePorta(); });
    document.getElementById('janela-calculate-btn').addEventListener('click', e => { e.preventDefault(); calculateJanela(); });
    onConfigChange(defaultConfig);
  </script>
</body>
</html>
